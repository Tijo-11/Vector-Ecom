# .ebextensions/django.config

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: "backend.settings"
    PYTHONPATH: "/var/app/current:$PYTHONPATH"
  aws:elasticbeanstalk:container:python:
    WSGIPath: backend.wsgi:application

container_commands:
  01_migrate:
    command: "source /var/app/venv/*/bin/activate && python manage.py migrate --noinput"
    leader_only: true
  02_collectstatic:
    command: "source /var/app/venv/*/bin/activate && python manage.py collectstatic --noinput || echo 'Collectstatic skipped'"
    leader_only: true

files:
  "/opt/elasticbeanstalk/tasks/bundlelogs.d/01-app-logs.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/app/current/*.log
      /var/log/django/*.log

  "/opt/elasticbeanstalk/tasks/taillogs.d/01-app-logs.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/app/current/*.log
      /var/log/django/*.log